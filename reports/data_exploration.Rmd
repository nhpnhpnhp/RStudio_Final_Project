---
title: "Phân tích Dịch COVID-19: Khám phá Dữ liệu và Chuẩn bị môi trường"
author: "Lưu Trần Kim Phú - 23133055"
date: "2025-05-05"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = "D:/Đại học/TL-HOCKI2.2/TL_LT_R_CPT_QT/DoAn_R/FinalDataR/COVID19_Analysis")
library(readr)
library(ggplot2)
library(dplyr)      
library(tidyr)
```
knitr::opts_knit$set(root.dir = "D:/Đại học/TL-HOCKI2.2/TL_LT_R_CPT_QT/DoAn_R/FinalDataR/COVID19_Analysis")

## 1. Chuẩn bị môi trường

## Mô tả dự án
Dự án này tập trung vào việc phân tích diễn biến dịch COVID-19 trên toàn cầu, với các mục tiêu chính sau:
- Dự đoán số ca nhiễm tại Việt Nam trong 7 ngày tới (Time Series).
- Phân nhóm các quốc gia theo mức độ nguy cơ (Clustering).
- Phân loại quốc gia có nguy cơ tử vong cao hoặc thấp (Classification).
- Dự đoán số ca tử vong dựa trên các yếu tố như dân số, ca nhiễm, và số lượng xét nghiệm (Regression).

-------------------------------------------------------------------------------------------------------------------------------------------
## Dữ liệu sử dụng
Dự án sử dụng 5 file dữ liệu chính, được lưu trữ trong thư mục `data`:
- **`covid_19_clean_complete.csv`**: Dữ liệu chi tiết về số ca nhiễm, tử vong, và phục hồi theo ngày và quốc gia. File này sẽ được sử dụng chủ yếu cho dự đoán chuỗi thời gian (Time Series) tại Việt Nam.
- **`day_wise.csv`**: Dữ liệu tổng hợp toàn cầu theo ngày, bao gồm số ca nhiễm, tử vong, và phục hồi. File này sẽ được dùng để phân tích xu hướng toàn cầu trong phần EDA.
- **`full_grouped.csv`**: Dữ liệu nhóm theo quốc gia và ngày, bao gồm số ca mới, tử vong mới, và phục hồi mới. File này sẽ được dùng để phân tích tăng trưởng ca nhiễm ở các quốc gia như Việt Nam, Mỹ, Brazil.
- **`worldometer_data.csv`**: Dữ liệu tổng hợp từ Worldometer, bao gồm số liệu tổng ca nhiễm, tử vong, xét nghiệm, dân số, v.v. File này sẽ được dùng cho Clustering, Classification, và Regression.
- **`usa_county_wise.csv`**: Dữ liệu chi tiết theo quận tại Mỹ, bao gồm số ca nhiễm và tử vong. File này có thể được dùng để phân tích bổ sung (nếu cần).

-------------------------------------------------------------------------------------------------------------------------------------------
## Danh sách thư viện đã tải
Các thư viện đã được tải trong file `finalization_deployment.R` bao gồm:
- `tidyverse` (bao gồm `dplyr`, `ggplot2`, v.v.): Xử lý và trực quan hóa dữ liệu.
- `lubridate`: Xử lý dữ liệu ngày tháng.
- `prophet`: Dự đoán chuỗi thời gian.
- `caret`: Huấn luyện mô hình phân loại và hồi quy.
- `cluster`: Phân cụm.
- Các thư viện bổ sung: `zoo`, `reshape2`, `randomForest`, `shiny`.

-------------------------------------------------------------------------------------------------------------------------------------------
## 2. Bước 1: Xác định mục tiêu.
## Các mục tiêu phân tích

Dựa trên yêu cầu phân tích dữ liệu COVID-19, dự án đề xuất bốn mục tiêu chính như sau:
- **Time Series**: Dự đoán số ca nhiễm mới tại Việt Nam trong 7 ngày tới.
  - **Dữ liệu sử dụng**: `covid_19_clean_complete.csv` (lọc dữ liệu cho Việt Nam).
  - **Mô hình dự kiến**: Sử dụng `prophet` để dự đoán chuỗi thời gian dựa trên ngày và số ca nhiễm.

- **Clustering**: Phân nhóm các quốc gia trên thế giới theo mức độ nguy cơ của dịch.
  - **Dữ liệu sử dụng**: `worldometer_data.csv` (các cột như TotalCases, Deaths/1M_pop, ActiveCases).
  - **Mô hình dự kiến**: Sử dụng thuật toán `kmeans` để phân cụm.

- **Classification**: Phân loại các quốc gia thành nhóm có nguy cơ tử vong cao hoặc thấp.
  - **Dữ liệu sử dụng**: `worldometer_data.csv` (các cột như TotalDeaths, TotalCases, Population).
  - **Mô hình dự kiến**: Sử dụng `randomForest` để phân loại nhị phân.

- **Regression**: Dự đoán số ca tử vong dựa trên các yếu tố như dân số, số ca nhiễm, và số lượng xét nghiệm.
  - **Dữ liệu sử dụng**: `worldometer_data.csv` (các cột như Population, TotalCases, TotalTests).
  - **Mô hình dự kiến**: Sử dụng hồi quy tuyến tính (`lm`) hoặc hồi quy Lasso.

## Mục tiêu chính
- **Mục tiêu được chọn**: Time Series cho Việt Nam.
- **Lý do lựa chọn**:
  - Dữ liệu chuỗi thời gian trong `covid_19_clean_complete.csv` cung cấp thông tin đầy đủ về số ca nhiễm theo ngày tại Việt Nam.
  - Dự đoán số ca nhiễm trong 7 ngày tới có tính ứng dụng cao trong việc hỗ trợ hoạch định chính sách y tế.
  - Đây là mục tiêu khả thi với thư viện `prophet` đã được tải sẵn, phù hợp với phạm vi đồ án.

-------------------------------------------------------------------------------------------------------------------------------------------

## 3. Bước 2: Tiền xử lý & EDA

### Mô tả
Phần này tập trung vào việc tiền xử lý dữ liệu (xử lý NA, đổi kiểu Date, chuẩn hóa) và khám phá dữ liệu (EDA) để hiểu rõ xu hướng và đặc điểm của dịch COVID-19. Dữ liệu đã được làm sạch và lưu dưới dạng `cleaned_day_wise.csv` và `cleaned_worldometer.csv`.

### Trực quan hóa
#### Xu hướng toàn cầu (dựa trên cleaned_day_wise.csv)
  
```{r}
day_wise <- read_csv("../output/cleaned_day_wise.csv")
trend_data <- day_wise %>% select(Date, Confirmed, Deaths, Recovered) %>%
  pivot_longer(cols = c(Confirmed, Deaths, Recovered), names_to = "metric", values_to = "value")
ggplot(trend_data, aes(x = Date, y = value, color = metric)) +
  geom_line() + labs(title = "Xu hướng toàn cầu", x = "Ngày", y = "Số ca") + theme_minimal()
```


#### Top 10 quốc gia tử vong (dựa trên cleaned_worldometer.csv)
```{r}
worldometer <- read_csv("../output/cleaned_worldometer.csv")
top_deaths <- worldometer %>%
  group_by(`Country/Region`) %>%  # Nhóm theo quốc gia để tránh lặp
  summarise(TotalDeaths = sum(TotalDeaths, na.rm = TRUE)) %>%  # Tổng hợp TotalDeaths
  arrange(desc(TotalDeaths)) %>%
  head(10)
ggplot(top_deaths, aes(x = reorder(`Country/Region`, -TotalDeaths), y = TotalDeaths)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(title = "Top 10 quốc gia tử vong") +
  theme_minimal() + theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
#### Tăng trưởng Việt Nam, Mỹ, Brazil (dựa trên full_grouped.csv)
```{r}
full_grouped <- read_csv("Data/full_grouped.csv")
selected_countries <- full_grouped %>% filter(`Country/Region` %in% c("Vietnam", "US", "Brazil"))
ggplot(selected_countries, aes(x = Date, y = New_cases, color = `Country/Region`)) +
  geom_line() + labs(title = "Tăng trưởng ca mới: Việt Nam, Mỹ, Brazil") + theme_minimal()
```

#### Phân bố ca nhiễm theo lục địa (dựa trên cleaned_worldometer.csv)
```{r}
ggplot(worldometer, aes(x = Continent, y = TotalCases)) +
  geom_boxplot(fill = "lightblue") + labs(title = "Phân bố ca nhiễm theo lục địa") + theme_minimal()
```

#### Heatmap tương quan (dựa trên cleaned_worldometer.csv)
```{r}
cor_data <- worldometer %>% select(TotalCases, TotalDeaths, TotalTests, Population)
cor_matrix <- cor(cor_data, use = "complete.obs")
ggplot(data = melt(cor_matrix), aes(x = Var1, y = Var2, fill = value)) +
  geom_tile() + scale_fill_gradient2() + labs(title = "Heatmap tương quan") + theme_minimal()
```

##Nhận xét
  - **Xu hướng số ca nhiễm và tử vong tăng mạnh từ đầu năm 2020.**
  - **Mỹ và Brazil dẫn đầu về số ca tử vong.**
  - **Tương quan giữa TotalCases và TotalDeaths cao.**

rmarkdown::render("D:/Đại học/TL-HOCKI2.2/TL_LT_R_CPT_QT/DoAn_R/FinalDataR/COVID19_Analysis/reports/data_exploration.Rmd")


